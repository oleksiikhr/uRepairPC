(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{301:function(t,e,n){"use strict";n.d(e,"b",function(){return i});var i=["Home","Requests","Users","Settings","Roles","SettingsCore"];e.a=[].concat(i,["EquipmentManufacturers","EquipmentModels","EquipmentTypes","RequestStatuses","RequestPriorities","RequestTypes","Manifest","Global"])},302:function(t,e,n){"use strict";var i=n(28),o=n.n(i),s=n(301),a=n(18),r=n(0),l=n(99);function u(t){var e=l.a[r.a.home].title;return t?{title:e,routeName:a.a}:{title:e}}e.a={activated:function(){this.$nextTick(this.updateBreadcrumbs)},mounted:function(){this.$options.name&&s.a.includes(this.$options.name)||this.$nextTick(this.updateBreadcrumbs)},methods:{updateBreadcrumbs:function(){this.$options.breadcrumbs?this.$store.commit("template/SET_BREADCRUMBS",[u(!0)].concat(o()(this.$options.breadcrumbs))):this.$store.commit("template/SET_BREADCRUMBS",[u(!1)])}}}},305:function(t,e,n){"use strict";var i=n(302),o=n(99);e.a=function(t){return{breadcrumbs:[{title:o.a[t].title,routeName:t},{title:function(t){return"ID: ".concat(t.params.id||-1)}}],mixins:[i.a],data:function(){return{pageId:+this.$route.params.id}},computed:{model:function(){var e=this.$store.state.template.sidebar[t];return e&&e[this.pageId]?e[this.pageId]:{}},hasFetchDataFunc:function(){return"function"==typeof this.fetchData}},watch:{$route:function(){this.hasFetchDataFunc&&this.fetchData()}},created:function(){this.hasFetchDataFunc&&this.fetchData()}}}},306:function(t,e,n){"use strict";n.d(e,"a",function(){return u});var i=n(7),o=n.n(i),s=n(6),a=n.n(s),r=n(5),l=n.n(r),u=function(){function t(){o()(this,t)}return a()(t,null,[{key:"__API_POINT",value:function(t){return"requests/".concat(t,"/comments")}},{key:"fetchAll",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return l.a.get(this.__API_POINT(t),e)}},{key:"fetchEdit",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return l.a.put("".concat(this.__API_POINT(t),"/").concat(e),n,i)}},{key:"fetchStore",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return l.a.post(this.__API_POINT(t),e,n)}},{key:"fetchDelete",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return l.a.delete("".concat(this.__API_POINT(t),"/").concat(e),n)}}]),t}()},308:function(t,e,n){"use strict";n.d(e,"a",function(){return u});var i=n(7),o=n.n(i),s=n(6),a=n.n(s),r=n(5),l=n.n(r),u=function(){function t(){o()(this,t)}return a()(t,null,[{key:"__API_POINT",value:function(t){return"requests/".concat(t,"/files")}},{key:"fetchAll",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return l.a.get(this.__API_POINT(t),e)}},{key:"fetchEdit",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return l.a.put("".concat(this.__API_POINT(t),"/").concat(e),n,i)}},{key:"fetchStore",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return l.a.post(this.__API_POINT(t),e,n)}},{key:"fetchDelete",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return l.a.delete("".concat(this.__API_POINT(t),"/").concat(e),n)}}]),t}()},314:function(t,e,n){},362:function(t,e,n){"use strict";var i=n(314);n.n(i).a},417:function(t,e,n){"use strict";n.r(e);var i=n(28),o=n.n(i),s=n(3),a=n.n(s),r=n(306),l=n(308),u=n(10),c=n(103),d=n(0),m=n(305),f=n(1),h=n(15);function p(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,i)}return n}function _(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?p(n,!0).forEach(function(e){a()(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):p(n).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}var E={components:{TableCellColor:function(){return n.e(19).then(n.bind(null,452))},CommentCreate:function(){return n.e(70).then(n.bind(null,461))},CommentsList:function(){return n.e(71).then(n.bind(null,462))},TemplateOne:function(){return n.e(10).then(n.bind(null,463))},FilesList:function(){return n.e(21).then(n.bind(null,464))}},mixins:[Object(m.a)(d.a.requests)],data:function(){return{loading:!1,loadingFiles:!1,loadingComments:!1}},computed:{buttons:function(){var t=this;return[{title:"Оновити",type:h.a.SUCCESS,action:function(){return t.fetchRequest("loading")}},{title:"Редагувати",type:h.a.PRIMARY,permissions:[f.REQUESTS_EDIT_ALL,this.profile.id===this.model.user_id&&f.REQUESTS_EDIT_OWN,this.profile.id===this.model.assign_id&&f.REQUESTS_EDIT_ASSIGN],action:function(){return t.openDialog(n.e(98).then(n.bind(null,465)))}},{title:"Додати коментарій",type:h.a.PRIMARY,permissions:f.REQUESTS_COMMENTS_CREATE,action:function(){return t.openDialog(n.e(96).then(n.bind(null,466)))}},{title:"Завантажити файл",type:h.a.PRIMARY,permissions:f.REQUESTS_FILES_CREATE,action:function(){return t.openDialog(n.e(24).then(n.bind(null,467)))}},{title:"Видалити",type:h.a.DANGER,permissions:[f.REQUESTS_DELETE_ALL,this.profile.id===this.model.user_id&&f.REQUESTS_DELETE_OWN,this.profile.id===this.model.assign_id&&f.REQUESTS_DELETE_ASSIGN],action:function(){return t.openDialog(n.e(113).then(n.bind(null,468)))}}]},tableData:function(){var t=this,e=["location","user_name","assign_name","type_name","priority_name","status_name","equipment_name","equipment_serial_number","equipment_inventory_number","description","created_at","updated_at"],n=[];return this.$store.getters["requests/columns"].forEach(function(i){e.includes(i.prop)&&n.push(_({},i,{value:t.model[i.prop]}))}),n},profile:function(){return this.$store.state.profile.user},filesPermissions:function(){var t=this;return{"permission-create":f.REQUESTS_FILES_CREATE,"permission-download":function(e){return Object(u.d)(f.REQUESTS_FILES_DOWNLOAD_ALL)||Object(u.d)(f.REQUESTS_FILES_DOWNLOAD_OWN)&&e.user_id===t.profile.id},"permission-edit":function(e){return Object(u.d)(f.REQUESTS_FILES_EDIT_ALL)||Object(u.d)(f.REQUESTS_EDIT_OWN)&&e.user_id===t.profile.id},"permission-delete":function(e){return Object(u.d)(f.REQUESTS_FILES_DELETE_ALL)||Object(u.d)(f.REQUESTS_DELETE_OWN)&&e.user_id===t.profile.id}}},commentsPermissions:function(){var t=this;return{"permission-edit":function(e){return Object(u.d)(f.REQUESTS_COMMENTS_EDIT_ALL)||Object(u.d)(f.REQUESTS_COMMENTS_EDIT_OWN)&&e.user_id===t.profile.id},"permission-delete":function(e){return Object(u.d)(f.REQUESTS_COMMENTS_DELETE_ALL)||Object(u.d)(f.REQUESTS_COMMENTS_DELETE_OWN)&&e.user_id===t.profile.id}}},canCreateComment:function(){return Object(u.d)(f.REQUESTS_COMMENTS_CREATE)}},methods:{fetchData:function(){this.model.id||this.fetchRequest(),this.model.files||this.fetchRequestFiles(),this.model.comments||this.fetchRequestComments()},fetchRequest:function(){var t=this;this.loading=!0,c.a.fetchOne(this.pageId).catch(function(){t.$router.push({name:d.a.requests})}).finally(function(){t.loading=!1})},fetchRequestFiles:function(){var t=this;this.loadingFiles=!0,this.updateData({files:[]}),l.a.fetchAll(this.pageId).then(function(e){var n=e.data;t.updateData({files:n.request_files})}).finally(function(){t.loadingFiles=!1})},fetchRequestComments:function(){var t=this;this.loadingComments=!0,this.updateData({comments:[]}),r.a.fetchAll(this.pageId).then(function(e){var n=e.data;t.updateData({comments:n.request_comments})}).finally(function(){t.loadingComments=!1})},openDialog:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.$store.commit("template/OPEN_DIALOG",{component:function(){return t},attrs:_({request:this.model},n),events:{delete:function(){e.$router.push({name:d.a.requests})},"comment-create":this.onAddComment,"comment-update":function(t,n){var i=o()(e.model.comments);i[n]=t,e.updateData({comments:i})},"comment-delete":function(t){var n=o()(e.model.comments);n.splice(t,1),e.updateData({comments:n})},"files-upload":function(t){e.updateData({files:[].concat(o()(t),o()(e.model.files))})},"file-update":function(t,n){var i=o()(e.model.files);i[n]=t,e.updateData({files:i})},"file-delete":function(t){var n=o()(e.model.files);n.splice(t,1),e.updateData({files:n})}}})},updateData:function(t){c.a.sidebar().add(_({id:this.pageId},t))},onAddFile:function(){this.openDialog(n.e(24).then(n.bind(null,467)))},onEditFile:function(t,e){this.openDialog(n.e(99).then(n.bind(null,469)),{file:t,index:e})},onDeleteFile:function(t,e){this.openDialog(n.e(114).then(n.bind(null,470)),{file:t,index:e})},onAddComment:function(t){this.updateData({comments:[].concat(o()(this.model.comments),[t])})},onEditComment:function(t,e){this.openDialog(n.e(97).then(n.bind(null,471)),{comment:t,index:e})},onDeleteComment:function(t,e){this.openDialog(n.e(112).then(n.bind(null,472)),{comment:t,index:e})}}},v=(n(362),n(98)),S=Object(v.a)(E,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("template-one",{attrs:{buttons:t.buttons,"table-data":t.tableData,loading:t.loading},scopedSlots:t._u([{key:"table",fn:function(e){var i=e.row;return["priority_name"===i.prop?n("table-cell-color",{attrs:{value:i.value,color:t.model.priority_color}}):"status_name"===i.prop?n("table-cell-color",{attrs:{value:i.value,color:t.model.status_color}}):n("span",[t._v(t._s(i.value))])]}}])},[n("div",{staticClass:"title",attrs:{slot:"header"},slot:"header"},[t._v("\n    "+t._s(t.model.title)+"\n  ")]),t._v(" "),t._v(" "),t.model.files&&(t.model.files.length||t.loadingFiles)?n("div",{staticClass:"page--width"},[n("div",{staticClass:"divider"},[n("span",[t._v("Файли")])]),t._v(" "),n("div",[n("files-list",t._b({attrs:{files:t.model.files,loading:t.loadingFiles,"url-download":function(e){return"requests/"+t.model.id+"/files/"+e.id}},on:{add:t.onAddFile,edit:t.onEditFile,delete:t.onDeleteFile,refresh:t.fetchRequestFiles}},"files-list",t.filesPermissions,!1))],1)]):t._e(),t._v(" "),t.model.comments&&(t.model.comments.length||t.loadingComments)?n("div",{staticClass:"page--width"},[n("div",{staticClass:"divider"},[n("span",[t._v("Коментарії")])]),t._v(" "),n("comments-list",t._b({staticClass:"mb-20",attrs:{comments:t.model.comments,loading:t.loadingComments},on:{edit:t.onEditComment,delete:t.onDeleteComment,refresh:t.fetchRequestComments}},"comments-list",t.commentsPermissions,!1)),t._v(" "),t.canCreateComment?n("comment-create",{attrs:{request:t.model},on:{"comment-create":t.onAddComment}}):t._e()],1):t._e()])},[],!1,null,"0439dcb0",null);e.default=S.exports}}]);